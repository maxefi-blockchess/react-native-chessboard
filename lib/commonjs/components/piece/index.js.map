{"version":3,"names":["Piece","React","memo","forwardRef","ref","id","startPosition","square","size","chess","useChessEngine","refs","usePieceRefs","pieceEnabled","useSharedValue","isPromoting","useBoardPromotion","onSelectPiece","onMove","selectedSquare","turn","useBoardOperations","pieceSize","durations","move","moveDuration","gestureEnabled","gestureEnabledFromChessboardProps","useChessboardProps","useDerivedValue","value","charAt","toPosition","toTranslation","useReversePiecePosition","isGestureActive","offsetX","offsetY","scale","borderColor","translateX","x","translateY","y","validateMove","useCallback","from","to","moves","verbose","find","m","wrappedOnMoveForJSThread","moveTo","Promise","resolve","withTiming","duration","isFinished","runOnJS","undefined","movePiece","useImperativeHandle","enable","active","onStartTap","globalMoveTo","current","handleOnBegin","currentSquare","previousTappedSquare","gesture","Gesture","Pan","enabled","onBegin","onStart","onUpdate","translationX","translationY","onEnd","onFinalize","style","useAnimatedStyle","justifyContent","alignItems","position","zIndex","toFixed","borderWidth","backgroundColor","boxSize","width","height","transform","underlay","translation","borderRadius","prev","next"],"sources":["index.tsx"],"sourcesContent":["import type { Move, Square } from 'chess.js';\r\nimport React, { useCallback, useImperativeHandle } from 'react';\r\nimport { Gesture, GestureDetector } from 'react-native-gesture-handler';\r\nimport Animated, {\r\n  runOnJS,\r\n  useAnimatedStyle,\r\n  useDerivedValue,\r\n  useSharedValue,\r\n  withTiming,\r\n} from 'react-native-reanimated';\r\nimport { useChessboardProps } from '../../context/props-context/hooks';\r\nimport { useBoardOperations } from '../../context/board-operations-context/hooks';\r\nimport { useBoardPromotion } from '../../context/board-promotion-context/hooks';\r\nimport { usePieceRefs } from '../../context/board-refs-context/hooks';\r\nimport { useChessEngine } from '../../context/chess-engine-context/hooks';\r\nimport { useReversePiecePosition } from '../../notation';\r\nimport type { PieceType, Vector } from '../../types';\r\n\r\nimport { ChessPiece } from './visual-piece';\r\n\r\ntype PieceProps = {\r\n  id: PieceType;\r\n  startPosition: Vector;\r\n  square: Square;\r\n  size: number;\r\n};\r\n\r\nexport type ChessPieceRef = {\r\n  moveTo: (square: Square) => Promise<Move | undefined>;\r\n  enable: (activate: boolean) => void;\r\n};\r\n\r\nconst Piece = React.memo(\r\n  React.forwardRef<ChessPieceRef, PieceProps>(\r\n    ({ id, startPosition, square, size }, ref) => {\r\n      const chess = useChessEngine();\r\n      const refs = usePieceRefs();\r\n      const pieceEnabled = useSharedValue(true);\r\n      const { isPromoting } = useBoardPromotion();\r\n      const { onSelectPiece, onMove, selectedSquare, turn } =\r\n        useBoardOperations();\r\n\r\n      const {\r\n        pieceSize,\r\n        durations: { move: moveDuration },\r\n        gestureEnabled: gestureEnabledFromChessboardProps,\r\n      } = useChessboardProps();\r\n\r\n      const gestureEnabled = useDerivedValue(\r\n        () => turn.value === id.charAt(0) && gestureEnabledFromChessboardProps,\r\n        [id, gestureEnabledFromChessboardProps]\r\n      );\r\n\r\n      const { toPosition, toTranslation } = useReversePiecePosition();\r\n\r\n      const isGestureActive = useSharedValue(false);\r\n      const offsetX = useSharedValue(0);\r\n      const offsetY = useSharedValue(0);\r\n      const scale = useSharedValue(1);\r\n      const borderColor = useSharedValue(1);\r\n      const translateX = useSharedValue(startPosition.x * size);\r\n      const translateY = useSharedValue(startPosition.y * size);\r\n\r\n      const validateMove = useCallback(\r\n        (from: Square, to: Square) => {\r\n          return chess\r\n            .moves({ verbose: true })\r\n            .find((m) => m.from === from && m.to === to);\r\n        },\r\n        [chess]\r\n      );\r\n\r\n      const wrappedOnMoveForJSThread = useCallback(\r\n        ({ move }: { move: Move }) => {\r\n          onMove(move.from, move.to);\r\n        },\r\n        [onMove]\r\n      );\r\n\r\n      const moveTo = useCallback(\r\n        (from: Square, to: Square) => {\r\n          return new Promise<Move | undefined>((resolve) => {\r\n            const move = validateMove(from, to);\r\n            const { x, y } = toTranslation(move ? move.to : from);\r\n            translateX.value = withTiming(x, { duration: moveDuration }, () => {\r\n              offsetX.value = translateX.value;\r\n            });\r\n            translateY.value = withTiming(\r\n              y,\r\n              { duration: moveDuration },\r\n              (isFinished) => {\r\n                if (!isFinished) return;\r\n                offsetY.value = translateY.value;\r\n                isGestureActive.value = false;\r\n                if (move) {\r\n                  runOnJS(wrappedOnMoveForJSThread)({ move });\r\n                  // Ideally I must call the resolve method\r\n                  // inside the \"wrappedOnMoveForJSThread\" after\r\n                  // the \"onMove\" function.\r\n                  // Unfortunately I'm not able to pass a\r\n                  // function in the RunOnJS params\r\n                  runOnJS(resolve)(move);\r\n                } else {\r\n                  runOnJS(resolve)(undefined);\r\n                }\r\n              }\r\n            );\r\n          });\r\n        },\r\n        [\r\n          isGestureActive,\r\n          moveDuration,\r\n          offsetX,\r\n          offsetY,\r\n          toTranslation,\r\n          translateX,\r\n          translateY,\r\n          validateMove,\r\n          wrappedOnMoveForJSThread,\r\n        ]\r\n      );\r\n\r\n      const movePiece = useCallback(\r\n        (to: Square) => {\r\n          const from = toPosition({ x: offsetX.value, y: offsetY.value });\r\n          moveTo(from, to);\r\n        },\r\n        [moveTo, offsetX.value, offsetY.value, toPosition]\r\n      );\r\n\r\n      useImperativeHandle(\r\n        ref,\r\n        () => {\r\n          return {\r\n            moveTo: (to: Square) => {\r\n              return moveTo(square, to);\r\n            },\r\n            enable: (active: boolean) => {\r\n              pieceEnabled.value = active;\r\n            },\r\n          };\r\n        },\r\n        [moveTo, pieceEnabled, square]\r\n      );\r\n\r\n      const onStartTap = useCallback(\r\n        // eslint-disable-next-line no-shadow\r\n        (square: Square) => {\r\n          'worklet';\r\n          if (!onSelectPiece) {\r\n            return;\r\n          }\r\n          runOnJS(onSelectPiece)(square);\r\n        },\r\n        [onSelectPiece]\r\n      );\r\n\r\n      const globalMoveTo = useCallback(\r\n        (move: Move) => {\r\n          refs?.current?.[move.from].current.moveTo?.(move.to);\r\n        },\r\n        [refs]\r\n      );\r\n\r\n      const handleOnBegin = useCallback(() => {\r\n        const currentSquare = toPosition({\r\n          x: translateX.value,\r\n          y: translateY.value,\r\n        });\r\n\r\n        const previousTappedSquare = selectedSquare.value;\r\n        const move =\r\n          previousTappedSquare &&\r\n          validateMove(previousTappedSquare, currentSquare);\r\n\r\n        if (move) {\r\n          runOnJS(globalMoveTo)(move);\r\n          return;\r\n        }\r\n        if (!gestureEnabled.value) return;\r\n        scale.value = withTiming(1.2);\r\n        borderColor.value = withTiming(0);\r\n        onStartTap(square);\r\n      }, [\r\n        borderColor,\r\n        gestureEnabled.value,\r\n        globalMoveTo,\r\n        onStartTap,\r\n        scale,\r\n        selectedSquare.value,\r\n        square,\r\n        toPosition,\r\n        translateX.value,\r\n        translateY.value,\r\n        validateMove,\r\n      ]);\r\n\r\n      const gesture = Gesture.Pan()\r\n        .enabled(!isPromoting && pieceEnabled.value)\r\n        .onBegin(() => {\r\n          offsetX.value = translateX.value;\r\n          offsetY.value = translateY.value;\r\n          runOnJS(handleOnBegin)();\r\n        })\r\n        .onStart(() => {\r\n          if (!gestureEnabled.value) return;\r\n          isGestureActive.value = true;\r\n        })\r\n        .onUpdate(({ translationX, translationY }) => {\r\n          if (!gestureEnabled.value) return;\r\n          translateX.value = offsetX.value + translationX;\r\n          translateY.value = offsetY.value + translationY;\r\n        })\r\n        .onEnd(() => {\r\n          if (!gestureEnabled.value) return;\r\n          runOnJS(movePiece)(\r\n            toPosition({ x: translateX.value, y: translateY.value })\r\n          );\r\n        })\r\n        .onFinalize(() => {\r\n          scale.value = withTiming(1);\r\n          borderColor.value = withTiming(1);\r\n        });\r\n\r\n      const style = useAnimatedStyle(() => {\r\n        return {\r\n          justifyContent: 'center',\r\n          alignItems: 'center',\r\n          position: 'absolute',\r\n          zIndex: selectedSquare.value ? 100 : 10,\r\n          borderColor:\r\n            selectedSquare.value === square\r\n              ? `rgba(44, 141, 255,${borderColor.value.toFixed(2)})`\r\n              : 'transparent',\r\n          borderWidth: 1,\r\n          backgroundColor:\r\n            selectedSquare.value === square && !isGestureActive.value\r\n              ? `rgba(44, 141, 255, ${(borderColor.value / 5).toFixed(2)})`\r\n              : 'transparent',\r\n          boxSize: 'border-box',\r\n          width: pieceSize,\r\n          height: pieceSize,\r\n          transform: [\r\n            { translateX: translateX.value },\r\n            { translateY: translateY.value },\r\n            { scale: scale.value },\r\n          ],\r\n        };\r\n      });\r\n\r\n      const underlay = useAnimatedStyle(() => {\r\n        const position = toPosition({\r\n          x: translateX.value,\r\n          y: translateY.value,\r\n        });\r\n        const translation = toTranslation(position);\r\n        return {\r\n          position: 'absolute',\r\n          width: size * 2,\r\n          height: size * 2,\r\n          borderRadius: size,\r\n          zIndex: 0,\r\n          backgroundColor: 'transparent',\r\n          transform: [\r\n            { translateX: translation.x - size / 2 },\r\n            { translateY: translation.y - size / 2 },\r\n          ],\r\n        };\r\n      }, [size]);\r\n\r\n      return (\r\n        <>\r\n          <Animated.View style={underlay} />\r\n          <GestureDetector gesture={gesture}>\r\n            <Animated.View style={style}>\r\n              <ChessPiece id={id} />\r\n            </Animated.View>\r\n          </GestureDetector>\r\n        </>\r\n      );\r\n    }\r\n  ),\r\n  (prev, next) =>\r\n    prev.id === next.id &&\r\n    prev.size === next.size &&\r\n    prev.square === next.square\r\n);\r\n\r\nexport default Piece;\r\n"],"mappings":"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"}